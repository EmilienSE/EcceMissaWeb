<div class="paroisse em-block">
    <div class="paroisse-container">
        <div class="paroisse-title">
            <h2>Ma paroisse</h2>
            @if(!isLoading && !paroisse){
                <div class="add-button em-btn" (click)="openAddModal()">
                    <img src="assets/img/plus.svg" alt="Ajouter une paroisse">
                </div>
            } @else if(!isLoading && paroisse) {
                <div class="action-btns">
                    <div class="add-button em-btn" (click)="openEditModal()">
                        <img src="assets/img/edit.svg" alt="Modifier paroisse">
                    </div>
                    <div class="add-button em-btn" (click)="openDeleteModal()">
                        <img src="assets/img/trash.svg" alt="Supprimer paroisse">
                    </div>
                </div>
            }
        </div>
        @if (isLoading){
            <app-em-loader></app-em-loader>
        }
        <div class="paroisse-list">
            @if (paroisse && paroisse){
                <h3>{{paroisse.nom}} - <small>{{paroisse.diocese}}</small></h3>
                <p>Paiement : 
                    @if(paroisse.paiement_a_jour){
                        <span class="badge badge-success">A jour</span>
                        <div class="paroisse-btn">
                            <p class="em-btn" (click)="openBillingPortal().subscribe()">Accéder au portail client</p>
                        </div>
                    } @else {
                        <span class="em-btn danger" (click)="openRetryPayment().subscribe()">A régulariser</span>
                    }
                </p>
                <p>Code unique : <strong>{{paroisse.code_unique}}</strong></p>
                <p>Utilisateur(s) liés à la paroisse :</p>
                <div class="paroisse-btn">
                    @for(resp of paroisse.responsables; track resp){
                        <span class="badge">{{resp}}</span>
                    }
                </div>
                
                <div class="paroisse-btn">
                    <div class="em-btn danger" (click)="openLeaveParoisseModal()">
                        Quitter la paroisse
                    </div>
                </div>
            }
            @else if(!isLoading && !paroisse){
                <h3>Vous n'êtes rattaché à aucune paroisse</h3>
                <div class="paroisse-btn">
                    <div class="em-btn" (click)="openAddModal()">
                        <img src="assets/img/plus.svg" alt="Ajouter une paroisse">
                        Ajouter une paroisse
                    </div>
                    <div class="em-btn" (click)="openJoinModal()">
                        Rejoindre une paroisse
                    </div>
                </div>
            }
        </div>
        
    </div>
</div>